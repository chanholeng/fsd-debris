# 自制编译器

### 开始制作编译器

#### 本书的概要

* C 语言编译器 GCC，Java 编译器 Javac
* 现代 Linux 上的可执行文件，通常是指符合 ELF 这种特定形式的文件，使用 file 命令可以查看文件是否符合 ELF 格式。ELF 文件中包含了程序（机器语言代码）以及如何运行该程序的相关信息。
* ```gcc HelloWorld.c``` 的具体阶段：
  * 预处理：读入宏文件，将所有宏展开。近似于 sed 命令和 awk 命令这样的纯文本操作，不考虑语法含义。
  * 狭义的编译：生成汇编语言代码，一般以 .s 为拓展名。
  * 汇编：通过汇编器，生成目标文件。Linux 中的目标文件是 ELF 文件。
  * 链接：目标文件本身不能直接使用，需要处理程序库的加载 。通过链接处理生成的并不一定是可执行文件，也可以是程序库文件。
  * 编译器、解释器都是处理并运行编程语言的手段之一，统称为编程语言处理器。

#### 编译过程

* 狭义的编译大致有四个阶段：
  * 语法分析：对代码进行表象分析，将代码解析成语法树。
  * 语义分析：除去语法树多余内容并添加必要信息，生成抽象语法树 AST。语义分析包括以下处理，处理结果都会反映到抽象语法树中：
    * 区分变量为局部变量还是全局变量
    * 解析变量的声明和引用
    * 变量和表达式的类型检查
    * 检查在引用变量之前是否进行了初始化
    * 检查函数是否按照定义返回了结果
  * 生成中间代码：将抽象语法树转化为只在编译器内部使用的中间代码 IR。主要目的是为了支持多种编程语言或者机器语言。GCC 使用的是一种名为 RTL 的中间代码。
  * 代码生成：将中间代码转换为汇编语言。关键在于如何来填补编程语言和汇编语言之间的差异。汇编语言的限制较多，给其分配的局部变量寄存器只有不到 30 个。
  * 优化：此时最重要的是尽可能提高编译出来的程序的性能。

#### 使用 Cb 编译器进行编译

* 所需软件：Linux、JRE 1.5+、Java 编译器。

